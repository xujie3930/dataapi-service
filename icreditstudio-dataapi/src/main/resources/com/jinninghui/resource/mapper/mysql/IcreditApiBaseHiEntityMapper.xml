<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jinninghui.datasphere.icreditstudio.dataapi.mapper.IcreditApiBaseHiMapper">

    <select id="findByApiBaseId" resultType="com.jinninghui.datasphere.icreditstudio.dataapi.entity.IcreditApiBaseHiEntity">
        select *
        from icredit_api_base_hi
        where del_flag = 0
        <if test="apiId != null and apiId != ''">
            and api_base_id = #{apiId}
        </if>
        limit 1
    </select>

    <select id="getList" parameterType="com.jinninghui.datasphere.icreditstudio.dataapi.web.request.ApiHistoryListRequest" resultType="com.jinninghui.datasphere.icreditstudio.dataapi.web.result.ApiHistoryListResult">
        select id as apiHiId,api_version as apiVersion,publish_user as publishUser,name,publish_status as publishStatus,publish_time as publishTime
        from icredit_api_base_hi
        where del_flag = 0 and api_base_id = #{apiId}
        <if test="publishStatus != null">
            and publish_status = #{publishStatus}
        </if>
        <if test="publishDateStart != null and publishDateStart != ''">
            and publish_time &gt;= #{publishDateStart}
        </if>
        <if test="publishDateEnd != null and publishDateEnd != ''">
            and publish_time &lt;= #{publishDateEnd}
        </if>
        order by api_version desc
        limit #{pageStartNum},#{pageSize}
    </select>

    <select id="countApiBaseHi" parameterType="com.jinninghui.datasphere.icreditstudio.dataapi.web.request.ApiHistoryListRequest" resultType="java.lang.Long">
        select count(1)
        from icredit_api_base_hi
        where del_flag = 0 and api_base_id = #{apiId}
        <if test="publishStatus != null">
            and publish_status = #{publishStatus}
        </if>
        <if test="publishDateStart != null and publishDateStart != ''">
            and publish_time &gt;= #{publishDateStart}
        </if>
        <if test="publishDateEnd != null and publishDateEnd != ''">
            and publish_time &lt;= #{publishDateEnd}
        </if>
    </select>

    <select id="getApiVersionsByApiId" resultType="java.lang.Integer">
        select api_version as apiVersion
        from icredit_api_base_hi
        where api_base_id = #{apiId}
    </select>
</mapper>
